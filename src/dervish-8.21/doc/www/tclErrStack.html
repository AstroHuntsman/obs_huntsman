<HTML>
<HEAD>
<!--
 ************************************************************
 *++
 * FACILITY:	Dervish
 *		Documentation
 *
 * ABSTRACT:	Error stack documentation.
 *
 * ENVIRONMENT:	HTML (HyperText Markup Language).
 *		tclErrStack.html
 *
 * AUTHOR:	Tom Nicinski, Creation date:  2-Nov-1993
 *--
 ************************************************************
-->

<TITLE>Tcl Error Stack Extensions</TITLE>

<BODY>

<H1>Tcl Error Stack Extensions</H1>

<P>
Dervish provides both <A HREF="errStack.html">C routines</A> and Tcl procedures
the ability to push messages onto an error stack, independent of Tcl's built in
error handling (<B>errorInfo</B> and <B>errorCode</B>).
Only one error stack exists for a Dervish task.
Users can push errors encountered during code development onto the error stack
and review them later.

<P>
The stack is circular, retaining the most recently added error strings.
As error messages are pushed onto the stack (with
<A HREF="tclErrStack.html#errStackPush">errStackPushC</A>),
they may overflow, causing the oldest messages in the stack to be discarded.
Messages can be retrieved from the error stack, the latest message first,
then the one pushed before that, and so forth.

<P>
The following Tcl procedures are made available:

<DIR>
<LI><A HREF="tclErrStack.html#errStackClear">errStackClear</A>
<LI><A HREF="tclErrStack.html#errStackGetEarliest">errStackGetEarliest</A>
<LI><A HREF="tclErrStack.html#errStackGetNext">errStackGetNext</A>
<LI><A HREF="tclErrStack.html#errStackOverflow">errStackOverflow</A>
<LI><A HREF="tclErrStack.html#errStackPush">errStackPush</A>
</DIR>

<P>
The following routine is available for use within the C code of a Tcl
procedure:

<DIR>
<LI><A HREF="tclErrStack.html#shTclInterpAppendWithErrStack">shTclInterpAppendWithErrStack</A>
</DIR>

<PRE></PRE>

<H2><A NAME="Automatic Clearing">Automatic Clearing of the Error Stack</A></H2>

<P>
The user can explicitly clear the error stack with
<A HREF="tclErrStack.html#errStackClear">errStackClear</A>.
But, the error stack is also automatically cleared.
When a Tcl command is issued at the top level Tcl interpreter (level 1), the
first <B>errStackPush</B> will first clear the error stack.  This
push can be nested many levels down.  Subsequent pushes onto the error stack
below the top level of the Tcl interpreter will not clear the stack.
This behaviour is very similar to how Tcl handles its global variable
<B>errorInfo</B> with <B>Tcl_AddErrorInfo()</B>.

<P>
This automatic clearing of the error stack relieves the user from clearing the
stack.  Yet, it permits the contents of the error stack to be retrived by
later Tcl or C commands at the top level of the Tcl interpreter.
The only side effect occurs at the top level of the Tcl interpreter:
only one error message can be effectively pushed onto the error stack, since
each push will be the first since entering/returning to the top level of the
Tcl interpreter.

<P>
<UL>
<LI><STRONG>NOTE:</STRONG>
Technically, a specific Tcl interpreter must
be used.  In particular, it must be the one created by a call to
<B>shMainTcl_Init()</B>.
This Tcl interpreter should apply to most cases, since many Dervish-based
applications are modelled after <EM>${DERVISH_DIR}/examples/dervish_template.c</EM>.
<B>shMainTcl_Init()</B> is called in <B>main()</B> within that template file.
</UL>

<H2><A NAME="errStackClear">errStackClear</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     errStackClear  -  Clear the error stack of all messages

SYNOPSIS (Tcl Syntax)
     errStackClear

ARGUMENTS
     (None)

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string is
		empty.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Clear the error stack of all messages.

<H2><A NAME="errStackGetEarliest">errStackGetEarliest</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     errStackGetEarliest  -  Get the last message pushed onto the error stack

SYNOPSIS (Tcl Syntax)
     errStackGetEarliest

ARGUMENTS
     (None)

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string
		contains the latest error stack message.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Return the last message pushed onto the error stack.
If the error stack is empty, an null string will be returned.
This routine should be called before any calls to
<B>errStackGetNext</B> are made as
<B>errStackGetEarliest</B> resets the stack retrieval pointers.
Subsequent calls to
<A HREF="tclErrStack.html#errStackGetNext">errStackGetNext</A>
will properly return the next older message
(in a LIFO (Last In First Out) fashion).

<P>
<UL>
<LI><STRONG>NOTE:</STRONG>
<I>The name, <B>errStackGetEarliest</B> is a misnomer.  Previously, messages
were returned in a FIFO (First In First Out) fashion.  That behaviour has
changed, but the routine name has been retained to maintain compatibility.
</I>
</UL>

<H2><A NAME="errStackGetNext">errStackGetNext</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     errStackGetNext  -  Get next message from the error stack

SYNOPSIS (Tcl Syntax)
     errStackGetNext

ARGUMENTS
     (None)

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string
		contains the next error message.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Return the next message up the stack relative to the current stack retrieval
pointer.  Messages are returned in a LIFO (Last In First Out) fashion.
The stack retrieval pointer will also be updated.
<A HREF="tclErrStack.html#errStackGetEarliest">errStackGetEarliest</A>
should be called to get the last message pushed onto the stack and set the stack
retrieval pointer to a known location.
If no more messages are on the stack, a null string is returned.  Continued
calls to <B>errStackGetNext</B> will wrap around the error stack
(through all the empty messages) back to the top message on the stack.

<H2><A NAME="errStackOverflow">errStackOverflow</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     errStackOverflow  -  Get number of times the error stack overflowed

SYNOPSIS (Tcl Syntax)
     errStackOverflow

ARGUMENTS
     (None)

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string
		contains the number of times the error stack has overflowed
		since the last clearing.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Return the number of times the error stack overflowed (by pushing
messages with <B>errStackPush</B>) since the last time the stack
was cleared (<B>errStackClear</B>).
If no overflows have occurred, zero (<B>0</B>) is returned.
An overflow condition is not fatal, it only indicates that some error
messages have been lost.

<H2><A NAME="errStackPush">errStackPush</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     errStackPush  -  Push a message onto the error stack

SYNOPSIS (Tcl Syntax)
     errStackPush  &lt;format&gt;  [arg1 [...]]

     format	The format control string.  The Tcl format command is used to
		format the resulting string.
     argn	The arguments consumed by the conversion specifications in the
		format control string.

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string is
		empty.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Format an error string and push it onto the error stack.
If the pushing onto the error stack results in an overflow, the earliest
messages are discarded as necessary to make room for the new message.
Formatting of the message is specified with the Tcl <B>format</B>
format control string.
A newline (<B>\n</B>) is automatically appended to the error message.

<P>
If this is the first push onto the error stack since the top level of the
Tcl interpreter (level 1) was entered, the error stack is cleared prior to
the pushing of the formatted message.

<H2><A NAME="shTclInterpAppendWithErrStack">shTclInterpAppendWithErrStack</A></H2>

<P>The pure C layer of DERVISH supports an error stack, allowing a
routine to return long paragraphs of error information.  This routine
sets Interp->result to a list of the error strings set in the
errstack.  If the user types the word in interactively, or uses Tcl's
default error processing in a procedure, the error information will be
printed out. If the user uses the TCL verb CATCH to handle an error
explicitly, the error text can be manipulated by other TCL words.


<LISTING>
C SYNTAX:
   void shTclInterpAppendWithErrStack
   (
   Tcl_Interp 	*interp         /* MOD: Interpreter to set the result for */
   )
RETURNS:
   None.
                               
</LISTING>
<PRE></PRE>



</HTML>
