<HTML>
<HEAD>
<!-- *********************************************************************** -->
<!-- *++
<!-- * FACILITY:	Dervish
<!-- *			Documentation
<!-- *
<!-- * ABSTRACT:	Tcl interface to Dervish Tables.
<!-- *
<!-- * ENVIRONMENT:	HTML (HyperText Markup Language).
<!-- *			tclTbl.html
<!-- *
<!-- * AUTHOR:		Tom Nicinski, Creation date:  22-Nov-1993
<!-- *--
<!-- *********************************************************************** -->

<TITLE>Tables Under Dervish: Tcl API</TITLE>

<BODY>

<H1>Tables Under Dervish: Tcl API</H1>

<P>
Procedures for creating, accessing, and manipulating
<A HREF="dervish.fitsio.html#tblcol">Dervish Tables</A> are provided:

<DIR>
<LI>    <A HREF="tclTbl.html#tblColNew"><B>tblColNew</B></A>
<LI>    <A HREF="tclTbl.html#tblColDel"><B>tblColDel</B></A>
<LI>	<A HREF="tclTbl.html#tblInfoGet"><B>tblInfoGet</B></A>
<LI>	<A HREF="tclTbl.html#tblFldAdd"><B>tblFldAdd</B></A>
<LI>	<A HREF="tclTbl.html#tblFldInfoGet"><B>tblFldInfoGet</B></A>
<LI>	<A HREF="tclTbl.html#tblFldInfoClr"><B>tblFldInfoClr</B></A>
<LI>	<A HREF="tclTbl.html#tblFldInfoSet"><B>tblFldInfoSet</B></A>
<LI>	<A HREF="tclTbl.html#tblFldGet"><B>tblFldGet</B></A>
<LI>	<A HREF="tclTbl.html#tblFldSet"><B>tblFldSet</B></A>
<LI>	<A HREF="tclTbl.html#tblCompliesWithFits"><B>tblCompliesWithFits</B></A>
</DIR>

<P>
Users should be careful to understand the
<A HREF="dervish.fitsio.html#Dervish vs. FITS">differences in nomencalture</A>
between Dervish and FITS.

<H2><A NAME="Selecting Fields">Selecting Fields</A></H2>

<P>
Tcl commands referencing a particular Table field can specify one of two
field locating criteria: search by position or search by name.
The <VAR>-col</VAR> option indicates the selected field by position.
The position value is 0-indexed.

<P>
The <VAR>-field</VAR> option selects a field by its name.
Not all Table fields have a name associated with them.  Those that do,
store that name in the <A HREF="shTblAccess.html#TBLFLD"><SAMP>TBLFLD</SAMP></A>
member <CODE>TTYPE</CODE>.
By default, the first field that matches the <VAR>-field</VAR> name exactly
is the selected field.
This behaviour can be changed.
<VAR>-nocase</VAR> indicates that the comparisons of the <VAR>-field</VAR>
name against the <CODE>TTYPE</CODE> names will be case insensitive
(<VAR>-case</VAR> can be used to explicitly indicate that these comparisons
are case sensitive).
Also, <VAR>-fieldpos n</VAR> can be used to indicate that the <VAR>n</VAR>th
field (where <VAR>n</VAR> is 0-indexed) matching the <VAR>-field</VAR> name
be selected.

<!-- *********************************************************************** -->

<H2><A NAME="tblColNew">tblColNew</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     tblColNew  -  Return a handle to a new TBLCOL Table

SYNOPSIS (Tcl Syntax)
     tblColNew

ARGUMENTS
     None

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string
		contains the name of the created handle.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Create a <A HREF="dervish.fitsio.html#TBLCOL">Table</A>
(<A HREF="shTblAccess.html#TBLCOL"><SAMP>TBLCOL</SAMP></A> structure) and
return a new <A HREF="tclHandle.html">handle</A> to point to the Table.

<B>tblColNew</B> is an alias for the following command:

<PRE WIDTH="132">
     <A HREF="tclHandle.html#handleNewFromType"><B>handleNewFromType</B></A> TBLCOL
</PRE>

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="tblColDel">tblColDel</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     tblColDel  -  Delete the TBLCOL Table and its data

SYNOPSIS (Tcl Syntax)
     tblColDel  &lt;handle&gt;

ARGUMENTS
      handle	The TBLCOL Table handle.

RETURN VALUES
     TCL_OK	Success.  Successful completion.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Delete the <A HREF="dervish.fitsio.html#TBLCOL">Table</A>
(<A HREF="shTblAccess.html#TBLCOL"><SAMP>TBLCOL</SAMP></A> structure) and its
data pointed to by a <VAR>handle</VAR>.
<B>tblColDel</B> is an alias for the following command:

<PRE WIDTH="132">
     <A HREF="tclHandle.html#handleDelFromType"><B>handleDelFromType</B></A>
</PRE>

(which in turn invokes
<A HREF="shTbl.html#shTblcolDel"><B>shTblcolDel</B></A>).

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="tblInfoGet">tblInfoGet</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     tblInfoGet  -  Get information about a TBLCOL Table

SYNOPSIS (Tcl Syntax)
     tblInfoGet  &lt;handle&gt;

ARGUMENTS
      handle	The TBLCOL Table handle.

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string
		contains a Tcl keyed list of information.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Return information about the
<A HREF="shTblAccess.html#TBLCOL"><SAMP>TBLCOL</SAMP></A> Table.
The result is a Tcl keyed list:

<PRE WIDTH="132">
     {ROWCNT 5}  {FLDCNT 10}  ...
</PRE>

The following keys are always returned:

<UL>
<LI>	<SAMP>ROWCNT</SAMP><BR>
	The number of rows in the Table.  This is also the same value for the
	<A HREF="shTblAccess.html#ARRAY's 1st Dimension">first dimension</A>
	of each field (as described by the
	<A HREF="dervish.array.html#intro"><SAMP>ARRAY</SAMP></A>).
<P>
<LI>	<SAMP>FLDCNT</SAMP><BR>
	The number of fields in the Table.
</UL>

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="tblFldAdd">tblFldAdd</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     tblFldAdd  -  Add a field to a TBLCOL Table

SYNOPSIS (Tcl Syntax)
     tblFldAdd  &lt;handle&gt; &lt;-type dataType | -heaptype heapDataType&gt;
                         [-dim dimList]   [-heapcnt lenList]

ARGUMENTS
      handle	The TBLCOL Table handle.

     -type	The data type contained in the field.  If the data type is
		TBLHEAPDSC, -heaptype must be specified along with -heapcnt.

     -heaptype	The data type contained in the heap.  This implicitly sets
		-type to TBLHEAPDSC, so -type does not need to be explicitly
		set.  -heapcnt must be specified.

     -heapcnt	A list of the sizes of each variable length datum in the heap.
		The lengths are in -heaptype units.

     -dim	A list of the dimensions of the data within the field.  The
		dimensions are in row-major order. Dimensions can be zero (0).
		The first dimension must be the number of rows in the Table
		(which may also be zero (0)).

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string
		contains the field position (0-indexed).

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Add a new field to an existing Table.
The added field will be the last field in the Table.
Space for data within the field will also be allocated.
If <A HREF="shTblAccess.html#Heap">heap storage</A> is specified (with the
<VAR>-heaptype</VAR> option), space for the variable length data to be
contained in the heap is allocated also.
In both cases, the data area is zeroed.

<P>
Many of the switches correspond to the keyed data returned by
<A HREF="tclTbl.html#tblFldInfoGet"><B>tblFldInfoGet</B></A>.
The data type contained in the field,
<VAR>-type</VAR> and/or <VAR>-heaptype</VAR>,
<EM>must</EM> be specified.
The data type must be one of the data types supported through
<A HREF="dervish.dump.html#diskio">object schemas</A>.
For example, some of the primitive data types are
<SAMP>SCHAR</SAMP>, <SAMP>UCHAR</SAMP>,
<SAMP>INT</SAMP>, <SAMP>UINT</SAMP>,
<SAMP>SHORT</SAMP>, <SAMP>USHORT</SAMP>,
<SAMP>LONG</SAMP>, <SAMP>ULONG</SAMP>,
<SAMP>FLOAT</SAMP>, <SAMP>DOUBLE</SAMP>,
and <SAMP>STR</SAMP> (character strings).
A distinction should be made between character (signed or unsigned) values and
logical values
(the <A HREF="shTblAccess.html#LOGICAL"><SAMP>LOGICAL</SAMP></A> object schema).
The <SAMP>UNKNOWN</SAMP> object schema is <EM>not</EM> permitted.

<P>
The field data can be an array.
Implicitly, a field is a 1-dimensional array, whose size is the number of
rows in the Table.
A multi-dimensional array can be specified through the <VAR>-dim</VAR>
option.
The dimensions are in a list specified in <I>row-major</I> order, unlike FITS'
<I>column-major</I> order for <SAMP>TDIM</SAMP>n keywords.
Also, the first (slowest varying) dimension <EM>must</EM> be the number of
rows in the Table (equivalent to <SAMP>NAXIS2</SAMP>) (which is not present in
the FITS file <SAMP>TDIM</SAMP>n keyword for Binary Table extensions).
This can be zero (0) (in effect, an empty Table with fields).
If the <SAMP>TBLCOL</SAMP> is empty (no fields), then <VAR>-dim</VAR> must be
explicitly specified to establish the Table's row count.

<P>
<A HREF="dervish.array.html#nStar">Data indirection</A>
(corresponding to <B>tblFldInfoGet</B>'s <SAMP>NSTAR</SAMP> keyword)
is <EM>not</EM> supported.
The field's <A HREF="dervish.array.html#intro"><SAMP>ARRAY</SAMP></A> contains all the
data.
This is even true for heap data, as the <SAMP>ARRAY</SAMP> contains
<SAMP>TBLHEAPDSC</SAMP> heap descriptors.


<H3>Character Strings</H3>

<P>
The data type
<A HREF="dervish.array.html#Data Type Conventions"><SAMP>STR</SAMP></A>
should be used to represent character strings, rather than an array of
<SAMP>CHAR</SAMP>.
Using <SAMP>STR</SAMP> mandates the use of <VAR>-dim</SAMP>.  Besides the
number of Table rows (the first dimension), the maximum size of the string
must be specified (it's possible to have multi-dimensional strings also).
Strings should be null-terminated, so the last dimension size (fastest
varying index) should accomodate the
<A HREF="shTblRead.html#Beyond the FITS Standard">terminator</A>
<EM>expected</EM> for guaranteed null-termination.

<H3>Heap Data</H3>

<P>
Heap data can also be specified.
If <VAR>-heaptype</VAR> is specified, then heap data will be used.
<VAR>-type</VAR> must be
<A HREF="shTblAccess.html#TBLHEAPDSC"><SAMP>TBLHEAPDSC</SAMP></A>
(<VAR>-type</VAR> can be omitted, in which case it will be defaulted properly).
<VAR>-heaptype</VAR> can be any object schema that <VAR>-type</VAR> allows,
except <SAMP>TBLHEAPDSC</SAMP>.
As for the main data <SAMP>ARRAY</SAMP>, character strings (<SAMP>STR</SAMP>)
should have an additional character used for guaranteed null-termination.

<P>
The field's <SAMP>ARRAY</SAMP> contains heap descriptors
(<SAMP>TBLHEAPDSC</SAMP>) rather than the actual data.
The <SAMP>ARRAY</SAMP> must be 1-dimensional, thus <VAR>-dim</VAR> may only
specify the number of Table rows.
The heap data for each Table row is also 1-dimensional, but variable in size.
The lengths of the heap data are specified through <VAR>-heapcnt</VAR>.
Although all heap data does not need to be allocated,
heap data lengths must be specified in a list for <EM>each</EM> Table row,
even if the remaining lengths in the list are all zero (indicating no space
allocation).
If the heap data type is <SAMP>STR</SAMP>, the lengths should reflect the
<A HREF="shTblRead.html#Beyond the FITS Standard">additional character</A>
used to guarantee a null-terminator.
Based on this list of lengths, heap space is allocated and the
<SAMP>ARRAY</SAMP>'s heap descriptors (<SAMP>TBLHEAPDSC</SAMP>) are linked to
the heap.

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="tblFldInfoGet">tblFldInfoGet</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     tblFldInfoGet  -  Get information about a TBLCOL Table field

SYNOPSIS (Tcl Syntax)
     tblFldInfoGet  &lt;handle&gt; &lt;-col f | -field name [-fieldpos pos] [-[no]case]&gt;

ARGUMENTS
      handle	The TBLCOL Table handle.

     -col f	The Table field specified as a column number, as in the FITS
		keyword TFORMn, where n is (f + 1). -col conflicts with -field,
		-fieldpos, -case, and -nocase.

     -field name	The name of the field as specified by the FITS keyword
		TTYPEn.  -field conflicts with -col.

     -fieldpos pos	Select the pos'th field that matches the field name (as
		specified by -field).  -fieldpos is 0-indexed.  The default is
		0 (select the first field that matches).  -fieldpos conflicts
		with -col.

     -case	Compare -field names in a case sensitive manner.  This is the
		default behaviour.  -case conflicts with -col.

     -nocase	Compare -field names in a case insensitive manner.  -nocase
		conflicts with -col.

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string
		contains a Tcl keyed list of information.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Return information about the
<A HREF="tclTbl.html#Selecting Fields">specified field</A> from the Table.
The result is a Tcl keyed list:

<PRE WIDTH="132">
     {COL 5} {TYPE ULONG} {DIM {2 3 4}} {NSTAR 0} {EMPTY 0} ...
</PRE>

The following keys are always returned:

<UL>
<LI>	<SAMP>COL</SAMP>
<LI>	<SAMP>TYPE</SAMP>
<LI>	<SAMP>DIM</SAMP>
<LI>	<SAMP>NSTAR</SAMP>
<LI>	<SAMP>EMPTY</SAMP>
</UL>

The following keys might be returned, depending on whether they are being used:

<UL>
<LI>	<SAMP>HEAPTYPE</SAMP>
<P>
<LI>	<SAMP>TTYPE</SAMP>
<LI>	<SAMP>TUNIT</SAMP>
<LI>	<SAMP>TDISP</SAMP>
<LI>	<SAMP>TSCAL</SAMP>
<LI>	<SAMP>TZERO</SAMP>
<LI>	<SAMP>TNULL</SAMP>
<LI>	<SAMP>TSIGN</SAMP>
</UL>

The condition of some keys not being returned will need to be tested for,
either with <B>catch</B> or returning the <B>keylget</B> value to a
variable.  Consider testing for <SAMP>TTYPE</SAMP>:

<PRE WIDTH="132">
     <B>dervish&gt;</B> set fldInfo [tblFldInfoGet $binHand -col $tblFld]
     <I>{COL 5} {TYPE ULONG}  {DIM  {2 3 4}}  {NSTAR 0} {EMPTY 0}</I>
     <B>dervish&gt;</B> if {![catch {keylget fldInfo TTYPE}]}  {<I>TTYPE-code</I>}
     <B>dervish&gt;</B> if {![keylget fldInfo TTYPE fldTTYPE]} {<I>TTYPE-code</I>}
</PRE>

<P>
Note that most of the keys are similar to the FITS ASCII and Binary Table header
keywords, without the trailing "index."
However, there are some exceptions as to how they should be interpreted.

<UL>
<LI>	<SAMP>COL</SAMP> does <EM>not</EM> correspond to a FITS header keyword.
	<SAMP>COL</SAMP> is the field position (0-indexed) within the Table.
	It is useful for locating a field using <VAR>-col</VAR> (subsequent to
	an initial location with the slower <VAR>-field</VAR> option).
<P>
<LI>	<SAMP>TYPE</SAMP> is the
	<A HREF="dervish.dump.html#diskio">object schema</A> type of the data
	contained in the field's <SAMP>ARRAY</SAMP> data area.
<P>
<LI>	<SAMP>DIM</SAMP> is in <I>row-major</I> order, unlike FITS'
	<I>column-major</I> order for <SAMP>TDIM</SAMP>n keywords.
	Also, the first (slowest varying) dimension is the number of rows in
	the Table (equivalent to <SAMP>NAXIS2</SAMP>) (which is not present in
	the FITS file <SAMP>TDIM</SAMP>n keyword for Binary Table extensions).
<P>
<LI>	<SAMP>NSTAR</SAMP> is the
	<A HREF="dervish.array.html#nStar">amount of indirection</A> needed to
	reach the ultimate data, starting from the <SAMP>ARRAY</SAMP> data area.
<P>
<LI>	<SAMP>EMPTY</SAMP> is a boolean value (0 for false and 1 for true)
	indicating whether a data area (owned by the <SAMP>ARRAY</SAMP>)
	has been allocated for the field (whether any data is present).
<P>
<LI>	<SAMP>HEAPTYPE</SAMP> is the
	<A HREF="dervish.dump.html#diskio">object schema</A> type of the data
	contained in the field's <A HREF="shTblAccess.html#Heap">heap area</A>.
	The <SAMP>ARRAY</SAMP> data type, returned under the <SAMP>TYPE</SAMP>
	key, is
	<A HREF="shTblAccess.html#TBLHEAPDSC"><SAMP>TBLHEAPDSC</SAMP></A>.
<P>
<LI>	<A NAME="TNULL keyed list"><SAMP>TNULL</SAMP> contains a keyed list</A>
	with two possible keys: <SAMP>STR</SAMP> or <SAMP>INT</SAMP>,
	corresponding to a character string value and a signed integer value.
	Respectively, these are equivalent to the <SAMP>TNULL</SAMP>n value
	types for ASCII Tables and Binary Tables.
</UL>

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="tblFldInfoClr">tblFldInfoClr</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     tblFldInfoClr  -  Clear information from a TBLCOL Table field

SYNOPSIS (Tcl Syntax)
     tblFldInfoClr  &lt;handle&gt; &lt;-col f | -field name [-fieldpos pos] [-[no]case]&gt;
                    &lt;member&gt;

      handle	The TBLCOL Table handle.

     -col f	The Table field specified as a column number, as in the FITS
		keyword TFORMn, where n is (f + 1). -col conflicts with -field,
		-fieldpos, -case, and -nocase.

     -field name	The name of the field as specified by the FITS keyword
		TTYPEn.  -field conflicts with -col.

     -fieldpos pos	Select the pos'th field that matches the field name (as
		specified by -field).  -fieldpos is 0-indexed.  The default is
		0 (select the first field that matches).  -fieldpos conflicts
		with -col.

     -case	Compare -field names in a case sensitive manner.  This is the
		default behaviour.  -case conflicts with -col.

     -nocase	Compare -field names in a case insensitive manner.  -nocase
		conflicts with -col.

      member	The piece of information to clear.

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string is
		empty.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Clear information from the
<A HREF="tclTbl.html#Selecting Fields">specified field</A> from the Table.
Any previous value is destroyed (character strings are set to null strings and
numeric values are set to zero).
The following <VAR>member</VAR> values can be cleared:
<DIR>
<LI>	<SAMP>TTYPE</SAMP>
<LI>	<SAMP>TUNIT</SAMP>
<LI>	<SAMP>TNULLSTR</SAMP>
<LI>	<SAMP>TNULLINT</SAMP>
<LI>	<SAMP>TDISP</SAMP>
<LI>	<SAMP>TSCAL</SAMP>
<LI>	<SAMP>TZERO</SAMP>
</DIR>
All of these <VAR>member</VAR>s are those that can be returned by
<A HREF="tclTbl.html#tblFldInfoGet"><B>tblFldInfoGet</B></A>.
Note that <SAMP>TNULLSTR</SAMP> and <SAMP>TNULLINT</SAMP>
represent <B>tblFldInfoGet</B>'s
<A HREF="tclTbl.html#TNULL keyed list"><SAMP>TNULL</SAMP> keyed list's</A>
<SAMP>STR</SAMP> and <SAMP>INT</SAMP> subkeys respectively.

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="tblFldInfoSet">tblFldInfoSet</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     tblFldInfoSet  -  Set information about a TBLCOL Table field

SYNOPSIS (Tcl Syntax)
     tblFldInfoSet  &lt;handle&gt; &lt;-col f | -field name [-fieldpos pos] [-[no]case]&gt;
                    &lt;member&gt; &lt;value&gt;

      handle	The TBLCOL Table handle.

     -col f	The Table field specified as a column number, as in the FITS
		keyword TFORMn, where n is (f + 1). -col conflicts with -field,
		-fieldpos, -case, and -nocase.

     -field name	The name of the field as specified by the FITS keyword
		TTYPEn.  -field conflicts with -col.

     -fieldpos pos	Select the pos'th field that matches the field name (as
		specified by -field).  -fieldpos is 0-indexed.  The default is
		0 (select the first field that matches).  -fieldpos conflicts
		with -col.

     -case	Compare -field names in a case sensitive manner.  This is the
		default behaviour.  -case conflicts with -col.

     -nocase	Compare -field names in a case insensitive manner.  -nocase
		conflicts with -col.

      member	The piece of information to set.

      value	The value to set member to.

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string is
		the value to which the member was set.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Set information about the
<A HREF="tclTbl.html#Selecting Fields">specified field</A> from the Table.
Any previous value is destroyed.
The following <VAR>member</VAR>s can have their values set:
<DIR>
<LI>	<SAMP>TTYPE</SAMP>
<LI>	<SAMP>TUNIT</SAMP>
<LI>	<SAMP>TNULLSTR</SAMP>
<LI>	<SAMP>TNULLINT</SAMP>
<LI>	<SAMP>TDISP</SAMP>
<LI>	<SAMP>TSCAL</SAMP>
<LI>	<SAMP>TZERO</SAMP>
</DIR>
All of these <VAR>member</VAR>s are those that can be returned by
<A HREF="tclTbl.html#tblFldInfoGet"><B>tblFldInfoGet</B></A>.
Note that <SAMP>TNULLSTR</SAMP> and <SAMP>TNULLINT</SAMP>
represent <B>tblFldInfoGet</B>'s
<A HREF="tclTbl.html#TNULL keyed list"><SAMP>TNULL</SAMP> keyed list's</A>
<SAMP>STR</SAMP> and <SAMP>INT</SAMP> subkeys respectively.

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="tblFldGet">tblFldGet</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     tblFldGet  -  Get a field from a TBLCOL Table

SYNOPSIS (Tcl Syntax)
     tblFldGet  &lt;handle&gt; &lt;-col f | -field name [-fieldpos pos] [-[no]case]&gt;
                         [indices]

ARGUMENTS
      handle	The TBLCOL Table handle.

     -col f	The Table field specified as a column number, as in the FITS
		keyword TFORMn, where n is (f + 1). -col conflicts with -field,
		-fieldpos, -case, and -nocase.

     -field name	The name of the field as specified by the FITS keyword
		TTYPEn.  -field conflicts with -col.

     -fieldpos pos	Select the pos'th field that matches the field name (as
		specified by -field).  -fieldpos is 0-indexed.  The default is
		0 (select the first field that matches).  -fieldpos conflicts
		with -col.

     -case	Compare -field names in a case sensitive manner.  This is the
		default behaviour.  -case conflicts with -col.

     -nocase	Compare -field names in a case insensitive manner.  -nocase
		conflicts with -col.

      indices	The indices to reference an array element or a portion of an
		array.  If more than one index is passed, they must be enclosed
		in a Tcl list.  The first index is the Table row.  Not all
		indices need to be passed (even the Table row may be omitted).
		Indices are 0-indexed values.

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string
		contains the field value.  n-dimensional arrays are returned
		as Tcl lists (lists within lists where n is greater than 1).

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Return the value of the
<A HREF="tclTbl.html#Selecting Fields">specified field</A> from the
<SAMP>TBLCOL</SAMP> format Table.
If the requested field is an <I>n</I>-dimensional array, part or all of the
array may be returned.
If all indices are specified, then one array element (a scalar) is returned.
Otherwise, a Tcl list of values is returned.
Data stored indirectly through the <SAMP>ARRAY</SAMP>
(<A HREF="dervish.array.html#nStar"><CODE>nStar</CODE></A> is non-zero) is
<EM>not</EM> returned.

<P>
Consider an example with a 4-dimensional array. The first index is the
Binary Table row, the remaining three indices (in <I>row-major</I> order) are
those from the field's <SAMP>TDIM</SAMP>n keyword (which are specified in
<I>column-major</I> order).
The example array dimensions from field <CODE>$tblFld</CODE> are
<CODE>(15,4,3,2)</CODE>.
A scalar is gotten with:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld { 0 1 2 1 }
     <I>25890</I>
</PRE>

A 1-dimensional array is retrieved by not specifying the fastest varying
(final) index:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld { 0 1 2 }
     <I>3219  25890</I>
</PRE>

A 2-dimensional array is retrieved by not specifying the last two indices:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld { 0 1 }
     <I>{18  987}  {2001  156987}  {3219  25890}</I>
</PRE>

All field values for all rows in the Table are returned if no indices are
are passed:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld
     <I>{{18  987}  {2001  156987}  {3219  25890}}    {...}    ...</I>
</PRE>

<P>
Returned values are decimal.
<SAMP>TDISP</SAMP> from a field's
<A HREF="shTblAccess.html#TBLFLD"><SAMP>TBLFLD</SAMP></A> is <EM>not</EM>
used to format the output of <B>tblFldGet</B>.
If the field is a character string (data type `<SAMP>A</SAMP>'), the actual
character string is returned, rather than a numeric representation of it.
The character string is not quoted with braces (<SAMP>{}</SAMP>).
Consider an example where a Table has 2 rows and the field has 1
character string.
A single character from the string is gotten with:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld { 0 2 }
     <I>c</I>
</PRE>

The complete string from one row is gotten with:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld { 0 }
     <I>abcdef</I>
</PRE>

Character strings from all rows are gotten with:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld
     <I>{abcdef}  {xyz}</I>
</PRE>

<P>
Values can also be returned from data in
<A HREF="shTblAccess.html#Heap">heap</A>.
Heap data is described through
<A HREF="shTblAccess.html#TBLHEADDSC"><SAMP>TBLHEAPDSC</SAMP></A> structures
contained in an <A HREF="dervish.array.html#ARRAY"><SAMP>ARRAY</SAMP></A>.
This information is indexed in the manner as described above.
<B>tblFldGet</B> will return the heap data itself, not the
heap descriptors (<SAMP>TBLHEAPDSC</SAMP>) in the <SAMP>ARRAY</SAMP> data area.
Consider an example where each row in the field's <SAMP>ARRAY</SAMP>
contains 1 <SAMP>TBLHEAPDSC</SAMP>.
Specifying no indices will return all variable length arrays for all rows
in the field.  Each variable length array is considered to be 1-dimensional:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld
     <I>{35 987 2053}  {}  {-93 1045 28769 1534 100}</I>
</PRE>

Specifying only the Table row index, namely to access the
<SAMP>TBLHEAPDSC</SAMP> will return the complete variable length array in
heap associated with that Table row:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld { 0 }
     <I>35 987 2053</I>
</PRE>

Finally, an individual variable length array element is returned by
specifying an index beyond the number of dimensions of the field's
<SAMP>ARRAY</SAMP>:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld { 0 1 }
     <I>987</I>
</PRE>

<B>NOTE:</B><I>
Because there may be some controversy as to what the FITS keyword
<SAMP>TDIM</SAMP>n really means for variable length data (it should be
noted that the FITS Binary Table Standard lists <SAMP>TDIM</SAMP>n
as a convention for multidimensional arrays, not as part of the Standard),
<B>tblFldGet</B> restricts <SAMP>ARRAY</SAMP>s of <SAMP>TBLHEAPDSC</SAMP>s
to be 1-dimensional.
This is in keeping with Dervish's maintenance of
<A HREF="shTblAccess.html#Keeping Tables FITS Compliant">FITS compliance</A>
and Dervish Table consistency throught Dervish.
</I>

<H3>Limitations with Character Strings</H3>

<P>
When character strings are returned as part of an array of character strings
(object schema
<A HREF="dervish.array.html#Data Type Conventions"><SAMP>STR</SAMP></A>),
they are quoted to allow Tcl lists to represent the array.
This behaviour brings out a problem.
Consider a character string that contains one or more quote character
(open or close brace (<SAMP>{}</SAMP>)) that is returned as part of an array
of character strings (here, the field contains 2 character strings per row):

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldGet $binTbl -col $tblFld { 0 1 }
     <I>{abc}def}  {xyz}</I>
</PRE>

Problems will occur when trying to access one of the array elements; consider:

<PRE WIDTH="132">
     <B>dervish&gt;</B> set x [tblFldGet $binTbl -col $tblFld { 0 1 }]
     <I>{abc}def}  {xyz}</I>
     <B>dervish&gt;</B> lindex $x 0
     <I>Error: list element in braces followed by "def}" instead of space</I>
</PRE>

<P>
<B>NOTE:</B><I>
If <B>tblFldGet</B> were to quote the brace with a backslash
(<SAMP>\</SAMP>), behaviour would not be as expected.  Consider:

<PRE WIDTH="132">
     <B>dervish&gt;</B> set x [tblFldGet $binTbl -col $tblFld { 0 1 }]
     <I>{abc\}def}  {xyz}</I>
     <B>dervish&gt;</B> string index [lindex $x 0] 3
     <I>\</I>
</PRE>

Notice that the backslash (<SAMP>\</SAMP>) is treated by Tcl as part of the
string rather than quoting the character following it.
</I>

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="tblFldSet">tblFldSet</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     tblFldSet  -  Set TBLCOL Table field value(s)

SYNOPSIS (Tcl Syntax)
     tblFldSet  &lt;handle&gt; &lt;-col f | -field name [-fieldpos pos] [-[no]case]&gt;
                         [-trunc | -notrunc]  &lt;indices&gt; &lt;values&gt;

ARGUMENTS
      handle	The TBLCOL Table handle.

     -col f	The Table field specified as a column number, as in the FITS
		keyword TFORMn, where n is (f + 1). -col conflicts with -field,
		-fieldpos, -case, and -nocase.

     -field name	The name of the field as specified by the FITS keyword
		TTYPEn.  -field conflicts with -col.

     -fieldpos pos	Select the pos'th field that matches the field name (as
		specified by -field).  -fieldpos is 0-indexed.  The default is
		0 (select the first field that matches).  -fieldpos conflicts
		with -col.

     -case	Compare -field names in a case sensitive manner.  This is the
		default behaviour.  -case conflicts with -col.

     -nocase	Compare -field names in a case insensitive manner.  -nocase
		conflicts with -col.

     -trunc	If the array contains strings (object schema STR), allow the
		truncation of strings that are too long.  For non-STR data,
		-trunc is ignored.  -trunc conflicts with -notrunc.

     -notrunc	If the array contains strings (object schema STR), do not
		truncate strings which are too long;  instead, return with an
		error.  This is the default behaviour.  For non-STR data,
		-notrunc is ignored.  -notrunc conflicts with -trunc.

      indices	The indices to reference an array element or a portion of an
		array.  If more than one index is passed, they must be enclosed
		in a Tcl list.  The first index is the Table row.  Not all
		indices need to be passed (even the Table row may be omitted).
		Indices are 0-indexed values.

       values	A list of one or more values to assign to array elements.  The
		values must match the object schema type of the array.

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string
		contains the indices of the first array element to be set and
		the indices of the last array element to be set.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Set the value or values of the
<A HREF="tclTbl.html#Selecting Fields">specified field</A> in the
<SAMP>TBLCOL</SAMP> format Table.
If the requested field is an <I>n</I>-dimensional array, part or all of the
array may be set.
The starting array element to be set is determined from the <VAR>indices</VAR>.
For an <I>n</I>-dimensional array, if fewer than <I>n</I> indices are
provided, the missing (trailing) indices are treated as zeros.
<SAMP>ARRAY</SAMP>s which store data indirectly
(<A HREF="dervish.array.html#nStar"><CODE>nStar</CODE></A> is non-zero)
may <EM>not</EM> have values assigned to array elements.

<P>
<B>NOTE:</B>
<I>
Values cannot be set in <A HREF="shTblAccess.html#Heap">heap</A>.
</I>

<P>
From the starting array element, the <VAR>values</VAR> are sequentially
assigned to consecutive array elements.
This is possible as arrays are
<A HREF="dervish.array.html#Physical Layout">laid out</A> such that the
fastest varying indexed array elements are stored next to each other.
This does permit the list of <VAR>values</VAR> to span across "subarray"
boundaries.

<P>
Subarrays are based on the depth within the tree representing the
<A HREF="dervish.array.html#Hierarchy of Array Pointers">hierarchy of array pointers</A>.
Consider a 3-dimensional integer array with dimensions (2, 3, 2) in field
<CODE>$tblFld</CODE>.
Array elements, starting at <VAR>indices</VAR> (1, 0, 1), can be set with

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldSet $binTbl -col $tblFld {1 0 1} {9 4 3 7}
     <I>{1 0 1}  {1 2 0}</I>
</PRE>

Pictorally, the following array elements are set:

<PRE WIDTH="132">
     level
     -----
      -1            ___.___
                   /       \
                  /         \
       0        _0_         _<B>1</B>_  <------+-- <I>slowest varying indices</I>
               /   \       /   \        |
              /     \     /     \       |   <I>hierarchy of array</I>
       1     0---1---2   <B>0</B>---1---2      |   <I>pointers</I>
            /_\ /_\ /_\ /_\ /_\ /_\     |
            0 1 0 1 0 1 0 <B>1</B> 0 1 0 1  <--+-- <I>fastest varying indices</I>
           +-+-+-+-+-+-+-+-+-+-+-+-+  --.
       2   | | | | | | | |9|4|3|7| |    |   <I>data (array elements)</I>
           +-+-+-+-+-+-+-+-+-+-+-+-+  --'
</PRE>

corresponding to array elements indexed by (1, 0, 1), (1, 1, 0), (1, 1, 1), and
(1, 2, 0) respectively.

<P>
The indices first array element and the last array element to be set are
returned.  Again, consider the above 3-dimensional array:

<PRE WIDTH="132">
     <B>dervish&gt;</B> set range [tblFldSet $binTbl -col $tblFld 1 {8 21 5}]
     <I>{1 0 0}  {1 1 0}</I>
     <B>dervish&gt;</B> set elem(first) [lindex $range 0]
     <I>1 0 0</I>
     <B>dervish&gt;</B> set elem(last)  [lindex $range 1]
     <I>1 1 0</I>
</PRE>

<P>
<B>NOTE:</B>
<I>
Setting numeric values that are too large for the array data type
(such as 32768 for a signed 2 byte integer) results in an undetermined value
being assigned (-32768 is a possibility, but <EM>not</EM> guaranteed).
The outcome (resulting value and/or action such as an exception) is dependent
upon the machine and operating system.
</I>

<H3>Setting Character Strings</H3>

<P>
Character strings (object schema
<A HREF="dervish.array.html#Data Type Conventions"><SAMP>STR</SAMP></A>)
are handled somewhat differently than numeric or
<A HREF="shTblAccess.html#LOGICAL"><SAMP>LOGICAL</SAMP></A> data.
Although the array data elements are individual characters for <SAMP>STR</SAMP>,
<B>tblFldSet</B> works with complete null-terminated strings.

<P>
Tcl list elements, which the <VAR>values</VAR> parameter is comprised of,
are delimited by whitespace (blanks, tabs, etc.).  Character strings containing
whitespace <EM>must</EM> be quoted.
Consider a list with 2 character strings:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldSet $binTbl -col $tblFld 0 {{Spaces galore} hi}
</PRE>

It is <EM>inadequate</EM> to only escape the whitespace (with a backslash
(<SAMP>\</SAMP>)).  Tcl strips out the escape character and <B>tblFldSet</B>
subsequently detects 3 character strings (using the above example).

<P>
Supplied <VAR>indices</VAR> still indicate at which <EM>character</EM>
assignments are to begin at.
But, successive characters in the <VAR>values</VAR> are <EM>not</EM>
necessarily assigned to successive array elements.
Consider a 3-dimensional <SAMP>STR</SAMP> array of dimensions (2, 2, 5).
The fastest varying index, 5 here, is the maximum length of any string
(which includes the one character <EM>expected</EM> for
<A HREF="shTblRead.html#Beyond the FITS Standard">guaranteed null-termination</A>).

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldSet $binTbl -col $tblFld {0 1 2} {a bc def}
     <I>{0 1 2}  {1 1 3}</I>
</PRE>

Pictorally, the following array elements (characters) are set:

<PRE WIDTH="132">
             _______._______
            /               \
           /                 \
        __<B>0</B>__               __1__  <--------- <I>slowest varying indices</I>
       /     \             /     \
      /       \           /       \
   __0__     __<B>1</B>__     __0__     __1__  <---- <I>string referencing indices</I>
  /     \   /     \   /     \   /     \
 /_______\ /_______\ /_______\ /_______\
 0 1 2 3 4 0 1 <B>2</B> 3 4 0 1 2 3 4 0 1 2 3 4  <-- <I>fastest varying indices</I>
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     <I>(character referencing</I>
| | | | | | | |a|0| |b|c|0| | |d|e|f|0| |     <I>indices)</I>
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</PRE>

The trailing `<CODE>0</CODE>'s are the null-terminators.
Each string set in the array is terminated with a null character.
There is no means of setting one or more characters without them being
treated as null-terminated strings.

<P>
The setting of each string from <VAR>values</VAR> starts at the beginning of the
string within the array (the subarray referenced by the second fastest varying
index).
The characters `<CODE>a</CODE>', `<CODE>b</CODE>', `<CODE>c</CODE>',
`<CODE>d</CODE>', `<CODE>e</CODE>', and `<CODE>f</CODE>' from the strings
are not all assigned to adjacent array elements (as would be the case for
numeric or <SAMP>LOGICAL</SAMP> data).
In the above example, the first string, `<CODE>a</CODE>', is assigned to the
character indexed by (0, 1, 2) (within the string starting at (0, 1, 0)).
The second string, `<CODE>bc</CODE>', is assigned to the <EM>string</EM>
starting at the character indexed by (1, 0, 0).
The last string, `<CODE>def</CODE>' is assigned to the string starting at the
character indexed by (1, 1, 0).

<P>
<B>tblFldSet</B>'s result,
the indices of the starting and ending array elements that were set,
reflects two points:

<UL>
<LI>	The ending array element index is that of the null-terminator for the
	last string set.
<P>
<LI>	It's assumed that possibly all characters between the starting array
	element and the ending array element may have been set.
	The result does not indicate any gaps for array elements that were not
	set.
</UL>

<P>
By default, if one of the character string <VAR>values</VAR> is too long,
no strings are assigned to the array and the command fails.
The <VAR>-trunc</VAR> option can be used to override this behaviour.
Strings which are too long are truncated as they're assigned to the array.
The truncated strings are still null-terminated properly.
No warnings are provided if any strings are truncated.

<H4>Limitations with Character Strings</H4>

<P>
Setting character strings is troublesome if the value is to contain one or
more quote characters (open of close brace (<SAMP>{}</SAMP>)).
With such characters, the result from
<A HREF="tclTbl.html#tblFldGet"><B>tblFldGet</B></A> cannot be used directly

<PRE WIDTH="132">
     <B>dervish&gt;</B> set str [tblFldGet $binTbl -col $tblFld 0]
     <I>{abc}def} {xyz}</I>
     <B>dervish&gt;</B> tblFldSet $binTbl -col $tblFld 0 "$str"
     <I>Error: list element in braces followed by "def}" instead of space</I>
</PRE>

It is possible to set strings containing quotes by enclosing the overall
list of strings needs with Tcl's double quotes (<SAMP>"</SAMP>).
These permit string substitutions at the Tcl level.

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldSet $binTbl -col $tblFld 0 "abc}def {xyz}"
</PRE>

This solution brings about its own set of conditions.
They apply to each string in the list that <EM>contains</EM>, in this case,
brace quotes (either <SAMP>{</SAMP> or <SAMP>}</SAMP>):

<UL>
<LI>	Enclosing braces, such as those returned by <B>tblFldGet</B>, must
	be removed.
<P>
<LI>	Whitespace characters (such as blanks, (horizontal) tabs,
	line feeds (vertical tabs), and carriage returns) need to be escaped
	with the backslash (<SAMP>\</SAMP>).
	This action prevents the one string from being treated as multiple
	strings within the overall list.
<P>
<LI>	Any other quoting characters in the string
	(double quotes (<SAMP>"</SAMP>) and square brackets (<SAMP>[]</SAMP>))
	<EM>must</EM> be escaped with a backslash (<SAMP>\</SAMP>).
</UL>

As mentioned, this solution applies to a list of strings that was originally
quoted with braces (<SAMP>{}</SAMP>).  Similar solutions exist for lists
quoted with Tcl's other quotes.

<P>
There is a further limitation on string values:  namely, the first string
value may not begin with a dash (<SAMP>-</SAMP>):

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldSet $binTbl -col $tblFld 0 -strVal
     <I>ftclFullParse error: Too few parameters entered</I>
     <I>Error: Parsing error</I>
     <I>USAGE: tblFldSet &lt;handle&gt;</I> ...
</PRE>

The solution is to make sure that the there are enough quotes
(braces (<SAMP>{}</SAMP>)) around the string:

<PRE WIDTH="132">
     <B>dervish&gt;</B> tblFldSet $binTbl -col $tblFld 0 {{-strVal}}
</PRE>

The outer braces are stripped, as they enclose the list of values; in this case,
the list contains only one value.
The inner braces surround the first string value.
These too are stripped, as each string value has any quoting stripped
(the <VAR>values</VAR> parameter is treated as a Tcl list of lists).

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="tblCompliesWithFits">tblCompliesWithFits</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     tblCompliesWithFits  -  Return whether Table complies with FITS Standard

SYNOPSIS (Tcl Syntax)
     tblCompliesWithFits  &lt;handle&gt;  &lt;-ascii | -binary&gt;

ARGUMENTS
      handle	The TBLCOL Table handle.

     -ascii	Indicates that the FITS compliance test is to be made against
		the FITS TABLE extension (ASCII Table). -ascii conflicts with
		-binary.

     -binary	Indicates that the FITS compliance test is to be made against
		the FITS BINTABLE extension (Binary Table). -binary conflicts
		with -ascii.

RETURN VALUES
     TCL_OK	Success.  Successful completion.  The interp result string
		contains a Tcl true value (1) if the Table is FITS compliant;
		otherwise a Tcl false value (0) is returned.

     TCL_ERROR	Failure.  The interp result string contains an error message.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Return a Tcl true (1) or false (0) value indicating whether the Table, if
written out as either an FITS ASCII or Binary Table extension, would comply
with the FITS Standard.
If the Table would not map to a legal FITS header and data unit (HDU),
<B>tblCompliesWithFits</B> will return with an error rather than a true/false
value.
The selection of the FITS extension type, through either the <VAR>-ascii</VAR>
or <VAR>-binary</VAR> options, is required.

<P>
It is important to note that <B>tblCompliesWithFits</B> tests the
<EM>potential</EM> for a <SAMP>TBLCOL</SAMP> Table to be rendered
FITS-compliant rather than actually being FITS-compliant.
This subtle distinction applies when writing Binary Tables whose
integer <A HREF="dervish.dump.html#diskio">object schemas</A> do not translate
directly to a FITS-compliant data type.  In such cases, the Table writer
attempts to use the FITS community <EM>convention</EM> of setting
<SAMP>TSCAL</SAMP>n and <SAMP>TZERO</SAMP>n to
<A HREF="shTblWrite.html#TSCAL/TZERO">flip the "signedness"</A>
of the data type.

<!-- *********************************************************************** -->

</BODY>

<HR>
<ADDRESS><A HREF="dervish.authors.html#Nicinski">Tom Nicinski</A></ADDRESS>

</HTML>
