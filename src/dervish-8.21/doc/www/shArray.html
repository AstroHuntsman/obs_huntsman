<HTML>
<HEAD>
<!-- *********************************************************************** -->
<!-- *++
<!-- * FACILITY:	Dervish
<!-- *			Documentation
<!-- *
<!-- * ABSTRACT:	C interface to Dervish ARRAYs.
<!-- *
<!-- * ENVIRONMENT:	HTML (HyperText Markup Language).
<!-- *			shArray.html
<!-- *
<!-- * AUTHOR:		Tom Nicinski, Creation date: 25-Mar-1994
<!-- *--
<!-- *********************************************************************** -->

<TITLE>Dervish Arrays: C API</TITLE>

<H1>Dervish Arrays: C API</H1>

<P>
Procedures for creating and accessing Dervish
<A HREF="dervish.array.html#intro"><SAMP>ARRAY</SAMP>s</A> are provided:

<DIR>
<LI>	<A HREF="#shArrayDataAlloc"><B>shArrayDataAlloc</B></A>
<LI>	<A HREF="#shArrayDataFree"><B>shArrayDataFree</B></A>
<LI>	<A HREF="#shArrayNew"><B>shArrayNew</B></A>
<LI>	<A HREF="#shArrayDel"><B>shArrayDel</B></A>
</DIR>

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="shArrayDataAlloc">shArrayDataAlloc</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     shArrayDataAlloc  -  Allocate data area (and array pointer hierarchy)

SYNOPSIS (C Syntax)
     #include "shCArray.h"

     RET_CODE *shArrayDataAlloc
     (
     ARRAY                *array,        /* INOUT: Array to alloc space for  */
                    char  *schemaName    /* IN:    Object schema name        */
     )

RETURN VALUES
     SH_SUCCESS		Success.  Space for the ARRAY data area was allocated.

     SH_NOT_SUPPORTED	Failure.  The object schema name is unknown.  No data
			space was allocated.

     SH_MALLOC_ERR	Failure.  Space could not be allocated for the data
			and/or the hierarchy of array pointers.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Space for the <A HREF="dervish.array.html#intro"><SAMP>ARRAY</SAMP></A> is allocated,
along with any space needed for the
<A HREF="dervish.array.html#Hierarchy of Array Pointers">hierarchy of array pointers</A>.
The amount of space required is based on the <SAMP>ARRAY</SAMP> dimensions and
the object schema type that it will contain.

<P>
Some <A HREF="dervish.array.html#ARRAY"><SAMP>ARRAY</SAMP></A> members must be
filled <EM>prior</EM> to calling <B>shArrayDataAlloc</B>.
The number of <SAMP>ARRAY</SAMP> dimensions (<CODE>dimCnt</CODE>) and the
dimensions (<CODE>dim</CODE>) themselves must have been filled.
Additionally, for an unpassed <VAR>schemaName</VAR>, or a schema name of
`<SAMP>UNKNOWN</SAMP>', the size (<CODE>data.size</CODE> in bytes,
alignment (<CODE>data.align</CODE>, and address increments
(<CODE>data.incr</CODE>) for the data must have been filled in also.

<P>
If the amount of data <A HREF="dervish.array.html#nStar">indirection</A>
(<CODE>nStar</CODE>, which must be filled in prior to this call) is non-zero,
space is allocated for pointers to data, rather than the data (object schema)
type itself.
The hierarchy of array pointers will then reference the pointers in the actual
<SAMP>ARRAY</SAMP> data area.

<P>
Some peculiar behaviour to be aware of:

<UL>
<LI>	If the data area already has space allocated to it, it is freed first.
<P>
<LI>	If the object schema is not a recognized type (the primitive data
	types defined in
	<A HREF="../../include/shCAlign.h"><B>shCAlign.h</B></A>, then

	<UL>
	<P>
	<LI>	The size of the object schema is used as the best guess for
		the address increment.  This should be a perfectly valid
		assumption, since <B>sizeof</B> is supposed to (according to
		the ANSI C standard) return the size of the object plus any
		padding before and after the object.
	<P>
	<LI>	The worst case (largest) alignment factor is used.
	</UL>
<P>
<LI>	The data area is zeroed out.
<P>
<LI>	Character strings (object schema type of <SAMP>STR</SAMP>) are
	allocated as an array of characters, rather than pointers to
	strings.  Still, the <SAMP>STR</SAMP> data type is used to
	<A HREF="dervish.array.html#Data Type Conventions">distinguish
	character strings from byte arrays</A>.
</UL>

<P>
The <A HREF="dervish.array.html#Memory Use">space allocated</A> is based not
only on the <SAMP>ARRAY</SAMP> dimensions and data type, but also on the
alignment space needed between data elements.  Space is allocated such that
each element is aligned `naturally' for the platform on which Dervish is running.
The <A HREF="dervish.array.html#Hierarchy of Array Pointers">hierarchy of array pointers</A>
are then linked to reflect this alignment of data elements.
The subarray sizes,
<A HREF="dervish.array.html#ARRAY"><SAMP>ARRAY</SAMP>'s</A> <CODE>subArrCnt</CODE>,
are also filled, permitting the
<A HREF="dervish.array.html#Computing Array Element Locations">computation of array element locations</A>.

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="shArrayDataFree">shArrayDataFree</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     shArrayDataFree  -  Free data area (and array pointer hierarchy)

SYNOPSIS (C Syntax)
     #include "shCArray.h"

     RET_CODE *shArrayDataFree
     (
     ARRAY                *array         /* INOUT: Array to deallocate from  */
     )

RETURN VALUES
     SH_SUCCESS		Success.  Space from the ARRAY data area was freed.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
The space used by the <A HREF="dervish.array.html#intro"><SAMP>ARRAY</SAMP></A> data
area and
<A HREF="dervish.array.html#Hierarchy of Array Pointers">hierarchy of array pointers</A>
are freed.
For safety, these areas should have been allocated by
<A HREF="#shArrayDataAlloc"><B>shArrayDataAlloc</B></A>.

<P>
Any memory pointed to by the <SAMP>ARRAY</SAMP> data (some object schemas may
do this, or the amount of data <A HREF="dervish.array.html#nStar">indirection</A>
is non-zero) is <EM>not</EM> freed.  If such indirect data exists, the user
must insure that it is not lost inadvertently (memory leaks) by the freeing
of the <SAMP>ARRAY</SAMP> data area.

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="shArrayNew">shArrayNew</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     shArrayNew  -  Construct an instance of an ARRAY object schema

SYNOPSIS (C Syntax)
     #include "shCArray.h"

     ARRAY    *shArrayNew
     (
     void
     )

RETURN VALUES
     ARRAY *		Success.  The address of the ARRAY object.

     0			Failure.  The constructor function failed.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
<B>shArrayNew</B> is the constructor function for an
<A HREF="dervish.array.html#ARRAY"><SAMP>ARRAY</SAMP></A>
object <A HREF="dervish.dump.html#diskio">schema</A>.
It allocates space for an <SAMP>ARRAY</SAMP> object and intializes its
fields for any data area (including the
<A HREF="dervish.array.html#Hierarchy of Array Pointers">hierarchy of array pointers</A>).

<P>
This is the constructor function used by the <A HREF="handle.html">handle</A>
mechanism, such as the Tcl command
<A HREF="tclHandle.html#handleNewFromType"><B>handleNewFromType</B></A>.

<!-- *********************************************************************** -->

<!-- *********************************************************************** -->

<H2><A NAME="shArrayDel">shArrayDel</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     shArrayDel  -  Destroy an instance of an ARRAY object schema

SYNOPSIS (C Syntax)
     #include "shCArray.h"

     void      shArrayDel
     (
     ARRAY                *array,        /* IN:    ARRAY descriptor          */
     )

RETURN VALUES
     none
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
<B>shArrayDel</B> is the destructor function for an
<A HREF="dervish.array.html#ARRAY"><SAMP>ARRAY</SAMP></A>
object <A HREF="dervish.dump.html#diskio">schema</A>.
It deallocates space for an <SAMP>ARRAY</SAMP> object, along with any data
area (including the 
<A HREF="dervish.array.html#Hierarchy of Array Pointers">hierarchy of array pointers</A>)
that the <SAMP>ARRAY</SAMP> owns.
But, any optional information hung off the <SAMP>ARRAY</SAMP>'s
<CODE>info</CODE> member is <EM>not</EM> freed.

<P>
This is the destructor function used by the <A HREF="handle.html">handle</A>
mechanism, such as the Tcl command
<A HREF="tclHandle.html#handleDelFromType"><B>handleDelFromType</B></A>
(<A HREF="tclHandle.html#handleDel"><B>handleDel</B></A> only frees the
handle memory and does <EM>not</EM> call <B>shArrayDel</B> to free the memory
used by the <SAMP>ARRAY</SAMP>).

<!-- *********************************************************************** -->

</BODY>

<HR>
<ADDRESS><A HREF="dervish.authors.html#Nicinski">Tom Nicinski</A></ADDRESS>

</HTML>
