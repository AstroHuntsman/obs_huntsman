<HTML>
<HEAD>
<!--
 ************************************************************
 *++
 * FACILITY:	Dervish
 *		Documentation
 *
 * ABSTRACT:	Error stack documentation.
 *
 * ENVIRONMENT:	HTML (HyperText Markup Language).
 *		tclErrStack.html
 *
 * AUTHOR:	Tom Nicinski, Creation date:  2-Nov-1993
 *--
 ************************************************************
-->

<TITLE>Dervish Error Stack Routines</TITLE>

<BODY>

<H1>"C" Routines for Error Stack Extensions</H1>

<P>
Dervish provides both C routines and <A HREF="tclErrStack.html">Tcl procedures</A>
the ability to push messages onto an error stack, independent of Tcl's built in
error handling (<B>errorInfo</B> and <B>errorCode</B>).
Only one error stack exists for a Dervish task.
Users can push errors encountered during code development onto the error stack
and review them later.  Errors can then be
<A HREF="tclErrStack.html#shTclInterpAppendWithErrStack">appended onto the
interp</A> to enable them to be returned to Tcl.

<P>
The stack is circular, retaining the most recently added error strings.
As error messages are pushed onto the stack (with
<A HREF="errStack.html#shErrStackPush"><B>shErrStackPush()</B></A>),
they may overflow, causing the oldest messages in the stack to be discarded.
Messages can be retrieved from the error stack, the latest message first,
then the one pushed before that, and so forth.

<P>
The following Application Programming Interface (API) is made available:

<DIR>
<LI><A HREF="errStack.html#shErrStackClear"><B>shErrStackClear</B></A>
<LI><A HREF="errStack.html#shErrStackGetEarliest"><B>shErrStackGetEarliest</B></A>
<LI><A HREF="errStack.html#shErrStackGetNext"><B>shErrStackGetNext</B></A>
<LI><A HREF="errStack.html#shErrStackOverflow"><B>shErrStackOverflow</B></A>
<LI><A HREF="errStack.html#shErrStackPush"><B>shErrStackPush</B></A>
</DIR>
<PRE></PRE>

<H2><A NAME="Automatic Clearing">Automatic Clearing of the Error Stack</A></H2>

<P>
The user can explicitly clear the error stack with
<A HREF="errStack.html#shErrStackClear"><B>shErrStackClear()</B></A>.
But, the error stack is also automatically cleared.
When a Tcl command is issued at the top level Tcl interpreter (level 1), the
first <B>shErrStackPush()</B> will first clear the error stack.  This
push can be nested many levels down.  Subsequent pushes onto the error stack
below the top level of the Tcl interpreter will not clear the stack.
This behaviour is very similar to how Tcl handles its global variable
<B>errorInfo</B> with <B>Tcl_AddErrorInfo()</B>.

<P>
This automatic clearing of the error stack relieves the user from clearing the
stack.  Yet, it permits the contents of the error stack to be retrived by
later C or Tcl commands at the top level of the Tcl interpreter.
The only side effect occurs at the top level of the Tcl interpreter:
only one error message can be effectively pushed onto the error stack, since
each push will be the first since entering/returning to the top level of the
Tcl interpreter.

<P>
<UL>
<LI><STRONG>NOTE:</STRONG>
Technically, a specific Tcl interpreter must
be used.  In particular, it must be the one created by a call to
<B>shMainTcl_Init()</B>.
This Tcl interpreter should apply to most cases, since many Dervish-based
applications are modelled after <EM>${DERVISH_DIR}/examples/dervish_template.c</EM>.
<B>shMainTcl_Init()</B> is called in <B>main()</B> within that template file.
</UL>

<H2><A NAME="shErrStackClear">shErrStackClear</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     shErrStackClear  -  Clear the error stack of all messages

SYNOPSIS (C Syntax)
     void shErrStackClear
     (
     void
     )

RETURN VALUES
   (None)
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Clear the error stack of all messages.

<H2><A NAME="shErrStackGetEarliest">shErrStackGetEarliest</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     shErrStackGetEarliest  -  Get the last message pushed onto the error stack

SYNOPSIS (C Syntax)
     const char *shErrStackGetEarliest
     (
     void
     ) 

RETURN VALUES
     char *	Success.  Constant pointer to the latest message on the stack.

     NULL	Failure.
_______________________________________________________________________________

DESCRIPTION
</LISTING>
     
<P>
Return the last message pushed onto the error stack.
If the error stack is empty, a NULL will be returned.
This routine should be called before any calls to
<B>shErrStackGetNext()</B> are made as
<B>shErrStackGetEarliest()</B> resets the stack retrieval pointers.
Subsequent calls to
<A HREF="errStack.html#shErrStackGetNext"><B>shErrStackGetNext()</B></A>
will properly return the next older message
(in a LIFO (Last In First Out) fashion).

<P>
<UL>
<LI><STRONG>NOTE:</STRONG>
<I>The name, <B>shErrStackGetEarliest</B> is a misnomer.  Previously, messages
were returned in a FIFO (First In First Out) fashion.  That behaviour has
changed, but the routine name has been retained to maintain compatibility.
</I>
</UL>

<H2><A NAME="shErrStackGetNext">shErrStackGetNext</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     shErrStackGetNext  -  Get next message from the error stack

SYNOPSIS (C Syntax)
     const char *shErrStackGetNext
     (
     void
     )
                               
RETURN VALUES
     char *	Success.  Constant pointer to the next message from the stack.

     NULL	Failure.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Return the next message up the stack relative to the current stack retrieval
pointer.  Messages are returned in a LIFO (Last In First Out) fashion.
The stack retrieval pointer will also be updated.
<A HREF="errStack.html#shErrStackGetEarliest"><B>shErrStackGetEarliest()</B></A>
should be called once to get the first (earliest) message and set the stack
retrieval pointer to a known location.
If no more messages are on the stack, a NULL is returned.  Continued
calls to <B>shErrStackGetNext()</B> will wrap around the error stack
(ignoring any empty messages) back to the earliest message on the stack.

<H2><A NAME="shErrStackOverflow">shErrStackOverflow</A></H2>

<LISTING>
_______________________________________________________________________________

NAME
     shErrStackOverflow  -  Get the number of times error stack overflowed

SYNOPSIS (C Syntax)
     int shErrStackOverflow
     (
     void
     )

RETURN VALUES
       0	Success.  No stack overflow occurred.

     > 0	Success.  The number of error stack overflows.
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Return the number of times the error stack overflowed (by pushing
messages with <B>shErrStackPush()</B>) since the last time the stack
was cleared (<B>shErrStackClear()</B>).
If no overflows have occurred, zero is returned.
An overflow condition is not fatal, it only indicates that some
error messages have been lost.

<H2><A NAME="shErrStackPush">shErrStackPush</A></H2>

<LISTING>
_______________________________________________________________________________
NAME
     shErrStackPush  -  Push a message onto the error stack

SYNOPSIS (C Syntax)
     void shErrStackPush
     (
     const char *a_format,	/* IN:    sprintf(2V) format control string  */
     ...			/* IN:    Arguments consumed by conversion   */
				/*        ... specifications in the format   */
				/*        ... control string.                */
     )
                               
RETURN VALUES
     (None)
_______________________________________________________________________________

DESCRIPTION
</LISTING>

<P>
Format an error string and push it onto the error stack.
If the pushing onto the error stack results in an overflow, the earliest
messages are discarded as necessary to make room for the new message.
Formatting of the message is specified with a <B>sprintf()</B>
format control string.
A newline (<B>\n</B>) is automatically appended to the error message.

<P>
If this is the first push onto the error stack since the top level of the
Tcl interpreter (level 1) was entered, the error stack is cleared prior to
the pushing of the formatted message.

</HTML>
