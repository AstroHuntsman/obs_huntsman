<HTML>
<HEAD>

<TITLE>FITS I/O and Tables</TITLE>
<BODY>

<H1>FITS I/O and Tables</H1>
<H2>TCL API</H2>
<UL>
<LI><A HREF="tclFitsIo.html">Reading/writing FITS images</A>
<LI><A HREF="tclFits.html">Reading/writing FITS Tables (ASCII and Binary)</A>
</UL>

<H2>C Routine Interface</H2>
<UL>
<LI><A HREF="fitsIo.html">Reading/writing FITS files</A>
<LI><A HREF="shFits.html">Reading/writing FITS Tables (ASCII and Binary)</A>
</UL>

<H2>Contributed Functions</H2>
<UL>
<LI><A HREF="../../contrib/www/nextFrameProc.html">Utility functions for reading a sequence of FITS files.</A>
<LI><a href="../../contrib/www/binRead.html">binRead and binWrite utilities for reading and writing foreign binary files</A>
</UL>


<H2><A NAME="TBLCOL">FITS Tables Under Dervish</A></H2>

<P>
<SAMP>TBLCOL</SAMP>s are defined in the header file
<A HREF="../../include/shCTbl.h"><EM>shCTbl.h</EM></A>.
<P>
A generic FITS ASCII and Binary Table reader is supported by Dervish.
Both table types are described in
NOST's (NASA/Science Office of Standards and Technology)
<CITE><A HREF="/edoc/fits/fits_standard_100_1_1.ps">
Definition of the Flexible Image Transport System (FITS)</A></CITE>
standards document (NOST 100-1.1, September 29, 1995)
and
<CITE><A HREF="/edoc/fits/users_guide_vsn_3_0.ps">
A User's Guide for the Flexible Image Transport System (FITS)</A></CITE>
(Version 3.0, October 1992)

<P>
<B>NOTE:</B>
<I>
A later version of the <CITE>User's Guide</CITE> is available
(<A HREF="/edoc/fits/users_guide.ps">Version 3.1</A>, May 2, 1994).
The new Binary Table substring array convention is
<A HREF="shTblRead.html#Missing Out on FITS Features"><EM>not</EM>
supported</A>.
Although not related to Tables, the
<SAMP>IMAGE</SAMP> extension is also <EM>not</EM> supported
(see Section 5.3.1, "IMAGE Extension", (page 70) of the newer
<CITE>User's Guide</CITE>).
</I>

<P>
Under Dervish, ASCII and Binary Tables are stored in-memory in what is called
the <A HREF="shTblAccess.html#TBLCOL Tables">columnar, <SAMP>TBLCOL</SAMP></A>,
format.
When refering to the term "ASCII" or "Binary" Table, Dervish usually means the
in-memory copy, not the header and data unit (HDU) in the FITS file.
The context will clarify which Table, in-memory or FITS, is being discussed.

<P>
The <SAMP>TBLCOL</SAMP> format is flexible enough to accomodate both ASCII and
Binary Tables, including heap from Binary Tables.  Once a Table is created,
there is little need for the user to differentiate between an ASCII or a
Binary Table (except when it is written out to a FITS file).
The <SAMP>TBLCOL</SAMP> format allows the:

<UL>
<LI>	<A HREF="shTblRead.html">Reading</A>
	in of a ASCII or Binary Table from a FITS file.
<LI>	<A HREF="shTblAccess.html">Accessing</A>
	field information and data within a Table.
<LI>	<A HREF="shTblAccess.html#Creating a Table">Creation</A>
	of a Table.
<LI>	<A HREF="shTblWrite.html">Writing</A>
	out of some or all ASCII or Binary Table fields to a FITS file.
</UL>

<P>
The <SAMP>TBLCOL</SAMP> format stores ASCII or Binary Table fields in arrays,
each array corresponding to a field.  This allows quick and easy retrieval of
data in a column (field) oriented way.
An ASCII or Binary Table may be read into memory even if the user has no
<I>a priori</I> knowledge of the FITS file contents or Table structure.

<P>
To access Table data on a row-by-row basis more efficiently, a
<SAMP>TBLCOL</SAMP> Table can be <A HREF="shSchema.html">copied</A> to a Dervish
<A HREF="tclHandle.html">handle</A> and
<A HREF="dervish.dump.html#diskio">object schema</A>.
This allows access to Table data through C-like structures.
This format is more appropriate when accessing Table data row by row, using
multiple fields from the same row (rather than accessing all values of one
field which the <SAMP>TBLCOL</SAMP> format facilitates).
But, unlike the <SAMP>TBLCOL</SAMP> format, the Dervish handle must be constructed
by the user.
And, the handle is <EM>not</EM> considered to be a Table.

<P>
The following interfaces are provided to create and access Dervish Tables:
<DIR>
<LI>	<A HREF="shTbl.html">ANSI C</A>
<LI>	<A HREF="tclTbl.html">Tcl</A>
</DIR>
The following interfaces are provided to read and write FITS ASCII and Binary
Tables:
<DIR>
<LI>	<A HREF="shFits.html">ANSI C</A>
<LI>	<A HREF="tclFits.html">Tcl</A>
</DIR>

<H3><A NAME="Dervish vs. FITS">Dervish <I>vs.</I> FITS</A></H3>

<H4><A NAME="0-indexing vs. 1-indexing">0-indexing <I>vs.</I> 1-indexing</A></H4>

<P>
Dervish and FITS index structures, arrays, rows, fields, etc. differently.
Dervish uses 0-indexing.  Under Dervish, FITS' 1-indexing is changed to 0-indexing.
For example, the Primary Header and Data Unit (PDU) is the 1st HDU
(Header and Data Unit) under FITS, but the HDU 0 under Dervish.
Likewise, the 1st field in a Table is indexed with 0 under Dervish.

<P>
Still, Dervish error messages may indicate positions with oridinal numbers, but
this is made clear through the use of suffixes such as <I>st</I>, <I>nd</I>,
<I>rd</I>, and <I>th</I>.

<P>
There may still be some confusion, since FITS Table header keywords are
<EM>still</EM> 1-indexed.  When Dervish 0-indexes a field with <VAR>f</VAR>, the
corresponding FITS header keyword is <SAMP>KEYWORD</SAMP><VAR>n</VAR> where
<VAR>n</VAR> is (<VAR>f</VAR> + 1).

<H4><A NAME="Row-major vs. Column-major">Row-major <I>vs.</I> Column-major Order</A></H4>

<P>
Dervish uses C's convention of referencing arrays in <I>row-major</I> order
while FITS uses FORTRAN's convention of referencing arrays in
<I>column-major</I> order.  Consider the example (shown 0-indexed with
<VAR>n</VAR> elements)

<PRE WIDTH="132">
     (d , d , ..., d   )
       0   1        <VAR>n</VAR>-1
</PRE>

Under row-major ordering, the fastest varying index is the last index, namely

<PRE WIDTH="132">
     d
      <VAR>n</VAR>-1
</PRE>

Under column-major ordering, the fastest varying index is the first index,
namely

<PRE WIDTH="132">
     d
      0
</PRE>

<P>
When reading in FITS files, Dervish will change array dimensions from column-major
to row-major.  When an in-memory Table is written out in FITS format, the
row-major ordering will be changed to column-major for compatibility with the
FITS standard.

<H4><A NAME="What Comes In is not What Goes Out">What Comes In is <EM>not</EM> What Goes Out</A></H4>

<P>
In the case where a Dervish Table is created by reading it from a FITS ASCII or
Binary Table from a FITS file,
Dervish Tables <EM>are</EM> different than their originating FITS Table.
They are not an exact in-memory copy of the original HDU.
The data content is the same to the extent that a binary form of the original
data can represent (this is especially true for numeric values from ASCII
Tables).

<P>
But, there is also some loss of information, namely comments that existed in
the FITS header, but were not carried over to the
<A HREF="shTblAccess.html#Headers">Dervish header</A> or maintained in the
<A HREF="shTblAccess.html#TBLCOL"><SAMP>TBLCOL</SAMP></A> structures.
When a Dervish Table is <A HREF="shTblWrite.html">written out</A> to a FITS file
HDU, it will probably not be an exact copy of the FITS HDU that it originated
from.

<!-- *********************************************************************** -->

</BODY>

<HR>
<ADDRESS><A HREF="dervish.authors.html#Nicinski">Tom Nicinski</A></ADDRESS>

</HTML>

